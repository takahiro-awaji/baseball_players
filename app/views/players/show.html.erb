<%= render 'shared/header' %>

<div class="container mt-3">
  <% if @team == current_team %>
    <%= link_to "編集", edit_team_player_path(@player.team_id) %>
    <%= link_to "削除", team_player_path(@player.team_id), method: :delete, data: { confirm: "本当に削除してもいいですか？" } %>
  <% end %>

  <div class="row">
  <%# 選手画像の表示 %>
    <div class="col-lg-3 col-sm-4 text-center">
    <% if @player.image.present? %>
      <%= image_tag(@player.image, class: "m-2", size: "150x150") if @player.image.attached? %>
    <% else %>
      <%= image_tag('logo.jpg', class: "m-2", size: "150x150") %>
    <% end %>
    </div>
  <%# //選手画像の表示 %>

  <%# 選手名、背番号、ポジション、投打 %>
    <div class="col-lg-7 col-sm-6 text-center">
      <h2><%= @player.number %></h2>
      <h3><%= @player.name %></h3>
        <div class="progress">
          <div class="progress-bar bg-dark" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      <%= @player.main_position.name %> ／ <%= @player.at_pitch %>／<%= @player.at_bat %>
    </div>
  <%# //選手名、背番号、ポジション、投打 %>
  </div>

  <div class="row">
  <%# レーダーチャート %>
    <div class="col-lg-4 col-sm-4">
    <canvas id="radar-chart-batter" width="200" height="100" class="m-2"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    </div>
  <%# レーダーチャート %>
  
    <%# レーダーチャート %>
    <div class="col-lg-4 col-sm-4">
    <canvas id="radar-chart-pitcher" width="200" height="100" class="m-2"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    </div>
  <%# レーダーチャート %>
  </div>

  <div class="row">
    <div class="col-sm-10">
      <table class="table table-bordered">
        <tr>
          <th scope="row">所属チーム</th>
          <td><%= @player.team.team_name %></td>
        </tr>
        <tr>
          <th scope="row">選手名</th>
          <td><%= @player.name %></td>
        </tr>
        <tr>
          <th scope="row">性別</th>
          <td><%= @player.sex %></td>
        </tr>
        <tr>
          <th scope="row">生年月日</th>
          <td><%= @player.birthday %></td>
        </tr>
        <tr>
          <th scope="row">メインポジション</th>
          <td id="main-position"><%= @player.main_position.name %></td>
        </tr>
        <tr>
          <th scope="row">背番号</th>
          <td><%= @player.number %></td>
        </tr>
        <tr>
          <th scope="row">投／打</th>
          <td><%= @player.at_pitch %> / <%= @player.at_bat %></td>
        </tr>
        <tr>
          <th scope="row">サブポジション</th>
          <td><%= @player.sub_position %></td>
        </tr>
        <tr>
          <th scope="row">選手の役職</th>
          <td><%= simple_format(@player.player_post) %></td>
        </tr>
        <tr>
          <th scope="row">スタッフの役職</th>
          <td><%= simple_format(@player.staff_post) %></td>
        </tr>
        <tr>
          <th scope="row">野球歴</th>
          <td><%= simple_format(@player.carrer) %></td>
        </tr>
        <tr>
          <th scope="row">自己紹介</th>
          <td><%= simple_format(@player.promotion) %></td>
        </tr>
      </table>
    </div>
  </div>

  <div class="row col-10">
    <div class="col">
    <h3>個人成績</h3>
    <% if @batting_stats.present? %>
    <div class="overflow-auto">
    <table class="table text-center text-nowrap">
    <thead>
      <tr>
        <th scope="col">試合数</th>
        <th scope="col">打席</th>
        <th scope="col">打数</th>
        <th scope="col">安打</th>
        <th scope="col">打率</th>
        <th scope="col">打点</th>
        <th scope="col">得点</th>
        <th scope="col">出塁率</th>
        <th scope="col">盗塁</th>
        <th scope="col">二塁打</th>
        <th scope="col">三塁打</th>
        <th scope="col">本塁打</th>
        <th scope="col">長打率</th>
        <th scope="col">OPS</th>
        <th scope="col">三振</th>
        <th scope="col">四球</th>
        <th scope="col">死球</th>
        <th scope="col">犠打</th>
        <th scope="col">犠飛</th>
        <th scope="col">併殺</th>
        <th scope="col">敵失</th>
        <th scope="col">失策</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @batting_stats.count %></td>
        <td><%= @batting_stats.sum(:at_standing) %></td>
        <td><%= @batting_stats.sum(:at_hitting) %></td>
        <td><%= @batting_stats.sum(:hit) %></td>
        <td><%= sprintf("%.3f", @batting_stats.sum(:hit) / @batting_stats.sum(:at_hitting).to_f) %></td>
        <td><%= @batting_stats.sum(:run_batted_in) %></td>
        <td><%= @batting_stats.sum(:run) %></td>
        <td><%= sprintf("%.3f", (@batting_stats.sum(:hit) + @batting_stats.sum(:walk) + @batting_stats.sum(:hit_by_pitch)) / (@batting_stats.sum(:at_hitting) + @batting_stats.sum(:walk) + @batting_stats.sum(:hit_by_pitch) + @batting_stats.sum(:sacrifice_fly)).to_f) %></td>
        <td><%= @batting_stats.sum(:stolen_base) %></td>
        <td><%= @batting_stats.sum(:double) %></td>
        <td><%= @batting_stats.sum(:triple) %></td>
        <td><%= @batting_stats.sum(:homerun) %></td>
        <td><%= sprintf("%.3f", @batting_stats.sum(:hit) + (@batting_stats.sum(:double) * 2) + (@batting_stats.sum(:triple) * 3) + (@batting_stats.sum(:homerun) * 4) / @batting_stats.sum(:at_hitting).to_f) %></td>
        <td><%= sprintf("%.3f", (@batting_stats.sum(:hit) + @batting_stats.sum(:walk) + @batting_stats.sum(:hit_by_pitch)) / (@batting_stats.sum(:at_hitting) + @batting_stats.sum(:walk) + @batting_stats.sum(:hit_by_pitch) + @batting_stats.sum(:sacrifice_fly)).to_f) + sprintf("%.0f", @batting_stats.sum(:hit) + (@batting_stats.sum(:double) * 2) + (@batting_stats.sum(:triple) * 3) + (@batting_stats.sum(:homerun) * 4) / @batting_stats.sum(:at_hitting).to_f) %></td>
        <td><%= @batting_stats.sum(:strikeout) %></td>
        <td><%= @batting_stats.sum(:walk) %></td>
        <td><%= @batting_stats.sum(:hit_by_pitch) %></td>
        <td><%= @batting_stats.sum(:sacrifice_bunt) %></td>
        <td><%= @batting_stats.sum(:sacrifice_fly) %></td>
        <td><%= @batting_stats.sum(:double_play) %></td>
        <td><%= @batting_stats.sum(:opponent_error) %></td>
        <td><%= @batting_stats.sum(:fielding_error) %></td>
       </tr>
    </tbody>
    <tfoot>
      <tr>
        <th scope="col">試合数</th>
        <th scope="col">打席</th>
        <th scope="col">打数</th>
        <th scope="col">安打</th>
        <th scope="col">打率</th>
        <th scope="col">打点</th>
        <th scope="col">得点</th>
        <th scope="col">出塁率</th>
        <th scope="col">盗塁</th>
        <th scope="col">二塁打</th>
        <th scope="col">三塁打</th>
        <th scope="col">本塁打</th>
        <th scope="col">長打率</th>
        <th scope="col">OPS</th>
        <th scope="col">三振</th>
        <th scope="col">四球</th>
        <th scope="col">死球</th>
        <th scope="col">犠打</th>
        <th scope="col">犠飛</th>
        <th scope="col">併殺</th>
        <th scope="col">敵失</th>
        <th scope="col">失策</th>
      </tr>
    </tfoot>
    </table>
    </div>
  <% end %>
    </div>
  </div>
    
  <%= link_to "チームページへ戻る", "/teams/#{@team.id}" %>
  <%= link_to "トップページへ戻る", root_path %>

</div>

<%= render 'shared/footer' %>