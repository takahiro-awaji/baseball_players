<%= render 'shared/header' %>

<div class="container mt-3">
  <%# <% チームトップ画像 %>
  <% if @team.image.present? %>
    <div style="height: 400px;">
      <%= image_tag(@team.image, width: "100%", height: "100%") if @team.image.attached?  %>
    </div>
  <% else %>
    <div style="height: 400px;">
      <%= image_tag('default_team.jpg', width: "100%", height: "100%") %>
    </div>
  <% end %>
  <%# <% //チームトップ画像 %>

  <h2 class="mt-3"><%= @team.team_name %></h2>
  <%# 編集とかメニュー系 %>
  <% if @team == current_team %>
    <%= link_to "編集", edit_team_path(@team) %>
    <%= link_to "削除", team_path(@team), method: :delete, data: { confirm: "本当に削除してもいいですか？" } %>
    <%= link_to "選手新規登録", new_team_player_path(@team) %>
    <%= link_to "選手一覧", team_players_path(@team) %>
    <%= link_to "試合結果登録", new_team_game_path(@team) %>
    <%= link_to "試合結果一覧", team_games_path(@team) %>
  <% else %>
    <%= link_to "選手一覧", team_players_path(@team) %>
    <%= link_to "試合結果一覧", team_games_path(@team) %>
  <% end %>
  <%# //編集とかメニュー系 %>

  <div class="row">

    <div class="col">
      <a href="#" class="d-block bg-dark text-white">
      <h5 class="p-2">チームプロフィール</h5>
      </a>
      <table class="table">
        <tr>
          <th scope="row">チーム名</th>
          <td><%= @team.team_name %></td>
        </tr>
        <tr>
          <th scope="row">チーム名（カナ）</th>
          <td><%= @team.team_name_kana %></td>
        </tr>
        <tr>
          <th score="row">活動拠点</th>
          <td><%= @team.activity_base.name %></td>
        </tr>
        <tr>
          <th score="row">チーム区分</th>
          <td><%= @team.team_attribute.name %></td>
        </tr>
        <tr>
          <th score="row">チームレベル</th>
          <td><%= @team.team_level.name %></td>
        </tr>
        <tr>
          <th score="row">チーム平均年齢</th>
          <td><%= @team.team_player_age.name %></td>
        </tr>
        <tr>
          <th score="row">メンバー野球歴</th>
          <td><%= @team.team_player_history.name %></td>
        </tr>
        <tr>
          <th score="row">所属リーグ・団体・連盟等</th>
          <td><%= simple_format(@team.league) %></td>
        </tr>
        <tr>
          <th score="row">獲得タイトル</th>
          <td><%= simple_format(@team.team_title) %></td>
        </tr>
        <tr>
          <th score="row">チーム結成</th>
          <td><%= @team.since.name %></td>
        </tr>
        <tr>
          <th score="row">活動曜日</th>
          <td><%= @team.activity_day %></td>
        </tr>
        <tr>
          <th score="row">活動ペース</th>
          <td><%= @team.activity_pace.name %></td>
        </tr>
        <tr>
          <th score="row">年間試合数</th>
          <td><%= @team.games_per_year.name %></td>
        </tr>
        <tr>
          <th score="row">チームスローガン</th>
          <td><%= @team.team_slogan %></td>
        </tr>
        <tr>
          <th score="row">チーム紹介</th>
          <td><%= simple_format(@team.introduction) %></td>
        </tr>
      </table>
    </div>
    
    <div class="col">
      <a href="#" class="d-block bg-success text-white">
      <h5 class="p-2">選手一覧（最新登録10選手）</h5>
      </a>
        <div class="row">
          <% @players.each do |player| %>
          <div class="media col-6 p-3 position-relative border">
            <% if player.image.present? %>
              <%= link_to image_tag(player.image, class: "mr-3", size: "100x100"), "/teams/#{@team.id}/players/#{player.id}", class: "stretched-link" if player.image.attached? %>
            <% else %>
              <%= link_to image_tag('logo.jpg', class: "mr-3", size: "100x100"), "/teams/#{@team.id}/players/#{player.id}", class: "stretched-link" %>
            <% end %>
            <%= player.number %>　<%= player.name %><br />（<%= player.main_position.name %>)<br />（<%= player.at_pitch%>/<%= player.at_bat %>）          </div>
          <% end %>
        </div>
    </div>

    <div class="w-100 m-3"></div>
    
    <div class="col" style="height: mh-100;">
      <a href="#" class="d-block bg-primary text-white">
      <h5 class="p-2">試合結果一覧（最新5試合）</h5>
      </a>
        <div class="row">
          <table class="table">
            <thead class="thead-dark">
              <tr class="text-center">
                <th scope="col" width="25%">試合日</th>
                <th scope="col" width="40">対戦相手</th>
                <th scope="col" width="15%">結果</th>
                <th scope="col" width="15%">スコア</th>
              </tr>
            </thead>
            <tbody>
                <% @games.each do |game| %>
                <tr class="text-center">
                  <td class="position-relative"><%= link_to game.gameday, "/teams/#{@team.id}/games/#{game.id}", class: "stretched-link" %></td>
                  <td><%= game.opponent %></td>
                  <td><%= game.game_result %></td>
                  <td><%= game.game_myteam_score %> - <%= game.game_opponent_score %></td>
                </tr>
                <% end %>
              </tbody>
          </table>
        </div>
    </div>
    
    <div class="col">
      <a href="#" class="d-block bg-danger text-white">
      <h5 class="p-2">チーム成績</h5>
      </a>

      <div class="table-responsive-sm ">
        <table class="table">
          <thead>
            <tr class="text-center">
              <th scope="col">試合数</th>
              <th scope="col">勝ち</th>
              <th scope="col">負け</th>
              <th scope="col">引分</th>
              <th scope="col">勝率</th>
              <th scope="col">得点</th>
              <th scope="col">失点</th>
            </tr>
          </thead>
          <tbody>
            <tr class="text-center">
              <td><%= @game.count %></td>
              <td><%= @game.where(game_result: "勝ち").count %></td>
              <td><%= @game.where(game_result: "負け").count %></td>
              <td><%= @game.where(game_result: "引き分け").count %></td>
              <td><%= sprintf("%.3f",@game.where(game_result: "勝ち").count / @game.count.to_f) %></td>
              <td><%= @game.sum(:game_myteam_score) %></td>
              <td><%= @game.sum(:game_opponent_score) %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%= render 'shared/footer' %>